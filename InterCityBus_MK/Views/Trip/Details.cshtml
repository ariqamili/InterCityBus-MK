@model InterCityBus_MK.ViewModels.TripDisplayViewModel

@{
    ViewData["Title"] = "Trip Details";
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb bg-transparent p-0">
                    <li class="breadcrumb-item">
                        <a asp-controller="Home" asp-action="Index" class="text-decoration-none">
                            <i class="bi bi-house-fill me-1"></i>Home
                        </a>
                    </li>
                    <li class="breadcrumb-item active">Trip Details</li>
                </ol>
            </nav>

            <div class="card border-0 shadow-sm" style="border-radius: 16px; overflow: hidden;">
                <div class="py-4 px-4" style="background: var(--primary-gradient);">
                    <div class="d-flex justify-content-between align-items-center text-white flex-wrap gap-3">
                        <div>
                            <h2 class="mb-2 fw-bold">@Model.FromStationName → @Model.ToStationName</h2>
                            <p class="mb-0 opacity-75">
                                <i class="bi bi-building me-2"></i>@Model.CompanyName
                            </p>
                        </div>
                        <div class="text-end">
                            <div class="h2 mb-0 fw-bold">@Model.Price.ToString("N0") <small class="fs-5">MKD</small></div>
                            <small class="opacity-75">per passenger</small>
                        </div>
                    </div>
                </div>

                <div class="card-body p-4">
                    <div class="row g-4">
                        <div class="col-md-7">
                            <div class="mb-4">
                                <h5 class="fw-bold mb-3">
                                    <i class="bi bi-map me-2" style="color: var(--primary-color);"></i>
                                    Full Itinerary
                                </h5>
                                <div class="position-relative">
                                    @foreach (var stop in Model.AllStops)
                                    {
                                        <div class="d-flex align-items-start mb-3 position-relative" style="padding-left: 40px;">
                                            @if (stop != Model.AllStops.Last())
                                            {
                                                <div class="position-absolute"
                                                     style="left: 14px; top: 40px; bottom: -16px; width: 2px;
                                                                    background: linear-gradient(180deg, var(--primary-color) 0%, rgba(102, 126, 234, 0.3) 100%);"></div>
                                            }

                                            <div class="position-absolute d-flex align-items-center justify-content-center"
                                                 style="left: 0; width: 30px; height: 30px; border-radius: 50%;
                                                            background: var(--primary-gradient); color: white; font-weight: 600; font-size: 0.85rem; z-index: 1;">
                                                @stop.StopOrder
                                            </div>

                                            <div class="flex-grow-1 p-3 rounded-3"
                                                 style="background-color: var(--bg-light);">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h6 class="mb-1 fw-bold">@stop.StationName</h6>
                                                        <small class="text-muted">
                                                            <i class="bi bi-clock me-1"></i>@stop.ArrivalTime.ToString("HH:mm")
                                                        </small>
                                                    </div>
                                                    @if (stop.StopOrder == 1)
                                                    {
                                                        <span class="badge bg-success">Departure</span>
                                                    }
                                                    else if (stop == Model.AllStops.Last())
                                                    {
                                                        <span class="badge" style="background: var(--primary-gradient);">Arrival</span>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="col-md-5">
                            <div class="p-4 rounded-3 text-center"
                                 style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
                                        border: 2px solid rgba(102, 126, 234, 0.2);">
                                <div class="mb-4">
                                    <i class="bi bi-ticket-perforated display-1 mb-3"
                                       style="color: var(--primary-color);"></i>
                                    <h4 class="fw-bold mb-2">Ready to Travel?</h4>
                                    <p class="text-muted mb-0">Book your seat now and enjoy a comfortable journey</p>
                                </div>

                                <a asp-action="Book" asp-route-id="@Model.Id" class="btn-gradient w-100 py-3 mb-3">
                                    <i class="bi bi-calendar-check me-2"></i>Book Now
                                </a>

                                <div class="text-muted small">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Instant confirmation
                                </div>
                            </div>

                            <div class="mt-4">
                                <h6 class="fw-bold mb-3">Trip Information</h6>
                                <div class="d-flex align-items-center gap-2 mb-2">
                                    <i class="bi bi-building" style="color: var(--primary-color);"></i>
                                    <small class="text-muted">Company:</small>
                                    <strong class="ms-auto">@Model.CompanyName</strong>
                                </div>
                                <div class="d-flex align-items-center gap-2 mb-2">
                                    <i class="bi bi-geo-alt" style="color: var(--primary-color);"></i>
                                    <small class="text-muted">Route:</small>
                                    <strong class="ms-auto">@Model.FromStationName - @Model.ToStationName</strong>
                                </div>
                                <div class="d-flex align-items-center gap-2">
                                    <i class="bi bi-signpost-2" style="color: var(--primary-color);"></i>
                                    <small class="text-muted">Stops:</small>
                                    <strong class="ms-auto">@Model.AllStops.Count stations</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-footer bg-white border-0 p-4">
                    <div class="d-flex gap-3 flex-wrap">
                        <a asp-action="Index" asp-controller="Home" class="btn-outline-custom py-2 px-4">
                            <i class="bi bi-arrow-left me-2"></i>Back to Search
                        </a>
                        @if (User.IsInRole("Admin"))
                        {
                            <a asp-action="Edit" asp-route-id="@Model.Id" class="py-2 px-4"
                               style="background: linear-gradient(135deg, #ffc107 0%, #ff6f00 100%);
                                          color: white; border: none; border-radius: 8px; font-weight: 600; text-decoration: none;">
                                <i class="bi bi-pencil me-2"></i>Edit Trip
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
